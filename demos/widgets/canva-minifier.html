<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget to Canva Converter - 4000 Character Limit</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #034638;
            border-bottom: 3px solid #034638;
            padding-bottom: 10px;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .panel {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }
        .panel h2 {
            margin-top: 0;
            color: #034638;
        }
        textarea {
            width: 100%;
            height: 400px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 1px solid #ccc;
            padding: 10px;
            box-sizing: border-box;
        }
        .controls {
            background: #e8f5e8;
            border: 2px solid #034638;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        button {
            background: #034638;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #045a42;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .stat {
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #034638;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        input[type="checkbox"] {
            margin-right: 5px;
        }
        .preset-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .preset-btn {
            background: #582C83;
            font-size: 12px;
            padding: 8px 15px;
        }
        .preset-btn:hover {
            background: #6d3499;
        }
    </style>
</head>
<body>
    <h1>üéØ Widget to Canva Converter (4000 Character Limit)</h1>

    <div class="warning">
        ‚ö†Ô∏è <strong>Note:</strong> Most widgets can't be fully compressed to 4000 chars. This tool creates simplified versions optimized for Canva.
    </div>

    <div class="controls">
        <h3>Compression Options</h3>
        <div class="options">
            <label class="option">
                <input type="checkbox" id="removeComments" checked> Remove Comments
            </label>
            <label class="option">
                <input type="checkbox" id="removeWhitespace" checked> Remove Extra Whitespace
            </label>
            <label class="option">
                <input type="checkbox" id="minifyCSS" checked> Minify CSS
            </label>
            <label class="option">
                <input type="checkbox" id="minifyJS" checked> Minify JavaScript
            </label>
            <label class="option">
                <input type="checkbox" id="shortenClasses" checked> Shorten Class Names
            </label>
            <label class="option">
                <input type="checkbox" id="removeAnimations" checked> Remove Animations
            </label>
            <label class="option">
                <input type="checkbox" id="simplifyStyles"> Simplify Styles (Aggressive)
            </label>
            <label class="option">
                <input type="checkbox" id="externalizeResources"> Use External Resources
            </label>
        </div>

        <div class="preset-buttons">
            <button class="preset-btn" onclick="setPreset('minimal')">Minimal (Most Compression)</button>
            <button class="preset-btn" onclick="setPreset('balanced')">Balanced</button>
            <button class="preset-btn" onclick="setPreset('preserve')">Preserve Functionality</button>
        </div>

        <button onclick="convertWidget()">üöÄ Convert to Canva Format</button>
        <button onclick="copyToClipboard()">üìã Copy Result</button>
        <button onclick="downloadResult()">üíæ Download Result</button>
    </div>

    <div class="container">
        <div class="panel">
            <h2>Input: Paste Your Widget HTML</h2>
            <textarea id="input" placeholder="Paste your complete widget HTML here..."></textarea>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="inputChars">0</div>
                    <div class="stat-label">Characters</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="inputSize">0 KB</div>
                    <div class="stat-label">Size</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>Output: Canva-Ready Code</h2>
            <textarea id="output" placeholder="Converted code will appear here..."></textarea>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="outputChars">0</div>
                    <div class="stat-label">Characters</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="reduction">0%</div>
                    <div class="stat-label">Reduction</div>
                </div>
            </div>
            <div id="status"></div>
        </div>
    </div>

    <script>
        // Update character counts
        document.getElementById('input').addEventListener('input', updateStats);

        function updateStats() {
            const input = document.getElementById('input').value;
            const inputChars = input.length;
            const inputSize = (new Blob([input]).size / 1024).toFixed(1);

            document.getElementById('inputChars').textContent = inputChars.toLocaleString();
            document.getElementById('inputSize').textContent = inputSize + ' KB';
        }

        function convertWidget() {
            const input = document.getElementById('input').value;
            if (!input) {
                alert('Please paste your widget HTML first');
                return;
            }

            let output = input;

            // Remove comments
            if (document.getElementById('removeComments').checked) {
                output = output.replace(/<!--[\s\S]*?-->/g, '');
                output = output.replace(/\/\*[\s\S]*?\*\//g, '');
                output = output.replace(/\/\/.*/g, '');
            }

            // Remove extra whitespace
            if (document.getElementById('removeWhitespace').checked) {
                output = output.replace(/\s+/g, ' ');
                output = output.replace(/>\s+</g, '><');
                output = output.replace(/;\s+/g, ';');
                output = output.replace(/{\s+/g, '{');
                output = output.replace(/}\s+/g, '}');
                output = output.replace(/:\s+/g, ':');
            }

            // Minify CSS
            if (document.getElementById('minifyCSS').checked) {
                output = output.replace(/\s*([{}:;,])\s*/g, '$1');
                // Remove units from zero values
                output = output.replace(/:\s*0px/g, ':0');
                output = output.replace(/:\s*0em/g, ':0');
                output = output.replace(/:\s*0%/g, ':0');
            }

            // Minify JavaScript
            if (document.getElementById('minifyJS').checked) {
                // Basic JS minification (be careful not to break strings)
                output = output.replace(/\s*([=+\-*/%<>!&|,;{}()])\s*/g, '$1');
                // Shorten variable names (very basic)
                output = output.replace(/\bfunction\s+(\w+)/g, 'function $1');
                output = output.replace(/\bvar\s+/g, 'var ');
                output = output.replace(/\blet\s+/g, 'let ');
                output = output.replace(/\bconst\s+/g, 'const ');
            }

            // Shorten class names
            if (document.getElementById('shortenClasses').checked) {
                const classMap = {};
                let classCounter = 0;

                // Find all class names
                const classRegex = /class="([^"]+)"/g;
                const classes = new Set();
                let match;
                while ((match = classRegex.exec(output)) !== null) {
                    match[1].split(' ').forEach(c => classes.add(c));
                }

                // Create short names
                classes.forEach(cls => {
                    if (cls.length > 3) {
                        classMap[cls] = 'c' + classCounter++;
                    }
                });

                // Replace in HTML and CSS
                Object.entries(classMap).forEach(([long, short]) => {
                    output = output.replace(new RegExp('\\.' + long + '(?![\\w-])', 'g'), '.' + short);
                    output = output.replace(new RegExp('class="' + long + '"', 'g'), 'class="' + short + '"');
                    output = output.replace(new RegExp('class="([^"]*?)\\b' + long + '\\b', 'g'), 'class="$1' + short);
                });
            }

            // Remove animations
            if (document.getElementById('removeAnimations').checked) {
                output = output.replace(/animation[^;]+;/g, '');
                output = output.replace(/transition[^;]+;/g, '');
                output = output.replace(/@keyframes[^}]+}/g, '');
            }

            // Aggressive style simplification
            if (document.getElementById('simplifyStyles').checked) {
                // Remove shadows, gradients, etc.
                output = output.replace(/box-shadow[^;]+;/g, '');
                output = output.replace(/text-shadow[^;]+;/g, '');
                output = output.replace(/background-image[^;]+;/g, '');
                output = output.replace(/border-radius[^;]+;/g, '');
                output = output.replace(/transform[^;]+;/g, '');
            }

            // Externalize resources (create a loader)
            if (document.getElementById('externalizeResources').checked) {
                // Extract styles and scripts
                const styleMatch = output.match(/<style[^>]*>([\s\S]*?)<\/style>/);
                const scriptMatch = output.match(/<script[^>]*>([\s\S]*?)<\/script>/);

                if (styleMatch || scriptMatch) {
                    // Create minimal loader
                    output = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>body{font-family:Arial;padding:20px}.loading{text-align:center;color:#034638}</style>
</head>
<body>
<div class="loading">Loading widget...</div>
<script>
// Add external script loading here
// This is a template - you'd need to host the actual CSS/JS elsewhere
fetch('YOUR_CSS_URL').then(r=>r.text()).then(css=>{
  const s=document.createElement('style');
  s.textContent=css;
  document.head.appendChild(s);
});
fetch('YOUR_JS_URL').then(r=>r.text()).then(js=>{
  eval(js);
});
</script>
</body>
</html>`;
                    alert('Note: You need to host the CSS and JS files separately and update the URLs in the loader code.');
                }
            }

            // Update output
            document.getElementById('output').value = output;

            // Update stats
            const outputChars = output.length;
            const inputChars = input.length;
            const reduction = ((1 - outputChars / inputChars) * 100).toFixed(1);

            document.getElementById('outputChars').textContent = outputChars.toLocaleString();
            document.getElementById('reduction').textContent = reduction + '%';

            // Show status
            const status = document.getElementById('status');
            if (outputChars <= 4000) {
                status.className = 'success';
                status.innerHTML = '‚úÖ Success! Code is under 4000 characters and ready for Canva.';
            } else {
                status.className = 'warning';
                status.innerHTML = `‚ö†Ô∏è Still ${outputChars - 4000} characters over limit. Try more aggressive options or consider splitting into multiple widgets.`;
            }
        }

        function setPreset(type) {
            const options = {
                minimal: {
                    removeComments: true,
                    removeWhitespace: true,
                    minifyCSS: true,
                    minifyJS: true,
                    shortenClasses: true,
                    removeAnimations: true,
                    simplifyStyles: true,
                    externalizeResources: false
                },
                balanced: {
                    removeComments: true,
                    removeWhitespace: true,
                    minifyCSS: true,
                    minifyJS: true,
                    shortenClasses: false,
                    removeAnimations: true,
                    simplifyStyles: false,
                    externalizeResources: false
                },
                preserve: {
                    removeComments: true,
                    removeWhitespace: true,
                    minifyCSS: false,
                    minifyJS: false,
                    shortenClasses: false,
                    removeAnimations: false,
                    simplifyStyles: false,
                    externalizeResources: false
                }
            };

            const preset = options[type];
            Object.entries(preset).forEach(([key, value]) => {
                document.getElementById(key).checked = value;
            });
        }

        function copyToClipboard() {
            const output = document.getElementById('output');
            output.select();
            document.execCommand('copy');
            alert('Copied to clipboard!');
        }

        function downloadResult() {
            const output = document.getElementById('output').value;
            if (!output) {
                alert('No output to download');
                return;
            }

            const blob = new Blob([output], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'canva-widget.html';
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>