<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Linear Regression MSE Explorer - AMBA Template</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    /* AMBA Template Widget Styling */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      background: white;
      color: #333;
      line-height: 1.5;
      padding: 0;
      margin: 0;
    }

    /* AMBA dp-wrapper equivalent for widgets */
    .dp-wrapper {
      max-width: 800px;
      margin: 0 auto;
      padding: 15px;
      background: #ffffff;
    }

    /* AMBA content blocks */
    .dp-content-block {
      margin-bottom: 20px;
    }

    /* AMBA headings */
    .dp-has-icon {
      color: #034638;
      margin-bottom: 15px;
      font-size: 1.3em;
      font-weight: 600;
    }

    .dp-has-icon i {
      margin-right: 8px;
      color: #582C83;
    }

    /* AMBA accordion panels */
    .dp-panels-wrapper {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
    }

    .dp-panel-group {
      border-bottom: 1px solid #e2e8f0;
    }

    .dp-panel-group:last-child {
      border-bottom: none;
    }

    .dp-panel-heading {
      background: #f8f9fa;
      color: #034638;
      padding: 12px 16px;
      cursor: pointer;
      border: none;
      width: 100%;
      text-align: left;
      font-weight: 600;
      transition: background-color 0.2s ease;
    }

    .dp-panel-heading:hover {
      background: #e9ecef;
    }

    .dp-panel-heading[aria-expanded="true"] {
      background: #034638;
      color: white;
    }

    .dp-panel-content {
      padding: 16px;
      background: #ffffff;
    }

    .dp-panel-content[hidden] {
      display: none;
    }

    /* AMBA cards */
    .dp-card {
      border: 1px solid #dee2e6;
      border-radius: 6px;
      margin-bottom: 15px;
    }

    .dp-card.card {
      background: #ffffff;
    }

    .card-body {
      padding: 15px;
    }

    .card-title {
      color: #034638;
      font-size: 1.1em;
      font-weight: 600;
      margin-bottom: 8px;
    }

    /* Interactive controls styling */
    .controls-section {
      background: #f8f9fa;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      margin-bottom: 15px;
    }

    .control-group {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .control-group:last-child {
      margin-bottom: 0;
    }

    .control-label {
      font-weight: 600;
      color: #034638;
      min-width: 120px;
    }

    input[type="range"] {
      flex: 1;
      max-width: 250px;
      height: 6px;
      border-radius: 3px;
      background: #d1d5db;
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #582C83;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .value-display {
      background: #034638;
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      font-weight: bold;
      min-width: 70px;
      text-align: center;
    }

    .widget-btn {
      background: #034638;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.95em;
    }

    .widget-btn:hover {
      background: #0a5c49;
      transform: translateY(-1px);
    }

    .widget-btn.secondary {
      background: #582C83;
    }

    .widget-btn.secondary:hover {
      background: #6b3494;
    }

    /* Metrics display */
    .metrics-display {
      display: flex;
      gap: 12px;
      margin: 15px 0;
      flex-wrap: wrap;
    }

    .metric-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 12px;
      text-align: center;
      flex: 1;
      min-width: 140px;
    }

    .metric-value {
      font-size: 1.4em;
      font-weight: bold;
      color: #034638;
      margin-bottom: 4px;
    }

    .metric-label {
      font-size: 0.85em;
      color: #666;
      font-weight: 500;
    }

    /* Plot container */
    .plot-container {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
      margin: 15px 0;
    }

    /* AMBA list styling */
    .list-group {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .list-group-item {
      padding: 8px 12px;
      border-bottom: 1px solid #e9ecef;
      background: #f8f9fa;
      margin-bottom: 2px;
    }

    .list-group-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    /* Equation display */
    .equation-display {
      background: #f8f9fa;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 15px;
      text-align: center;
      font-family: 'Courier New', monospace;
      font-size: 1.1em;
      font-weight: bold;
      color: #034638;
      margin: 15px 0;
    }

    /* Status indicators */
    .status-indicator {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: 600;
      display: inline-block;
      margin-top: 8px;
    }

    .status-excellent {
      color: #166534;
      background: #dcfce7;
    }

    .status-good {
      color: #166534;
      background: #dcfce7;
    }

    .status-fair {
      color: #92400e;
      background: #fef3c7;
    }

    .status-poor {
      color: #991b1b;
      background: #fee2e2;
    }

    /* Responsive design */
    @media (max-width: 600px) {
      .dp-wrapper {
        padding: 10px;
      }

      .control-group {
        flex-direction: column;
        align-items: stretch;
        gap: 6px;
      }

      .control-label {
        min-width: auto;
      }

      .metrics-display {
        flex-direction: column;
      }

      .metric-card {
        min-width: auto;
      }
    }

    /* Animation */
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

<div class="dp-wrapper">
  <!-- Widget Title -->
  <div class="dp-content-block">
    <h2 class="dp-has-icon">
      <i class="fas fa-chart-line" aria-hidden="true"></i>
      Linear Regression MSE Explorer
    </h2>
  </div>

  <!-- Parameter Controls -->
  <div class="dp-content-block">
    <h3 class="dp-has-icon">
      <i class="fas fa-sliders-h" aria-hidden="true"></i>
      Model Parameters
    </h3>

    <div class="controls-section">
      <div class="control-group">
        <label class="control-label" for="slope-control">Slope:</label>
        <input type="range" id="slope-control" min="-2" max="8" step="0.1" value="2.5">
        <div class="value-display" id="slope-display">2.5</div>
      </div>

      <div class="control-group">
        <label class="control-label" for="intercept-control">Intercept:</label>
        <input type="range" id="intercept-control" min="-10" max="20" step="0.5" value="5">
        <div class="value-display" id="intercept-display">5</div>
      </div>

      <div class="control-group">
        <button class="widget-btn" id="find-optimal">ðŸŽ¯ Find Optimal Fit</button>
        <button class="widget-btn secondary" id="add-noise">ðŸŽ² Add Noise</button>
        <button class="widget-btn secondary" id="reset-data">ðŸ”„ Reset Data</button>
      </div>
    </div>
  </div>

  <!-- Current Equation -->
  <div class="dp-content-block">
    <h3 class="dp-has-icon">
      <i class="fas fa-calculator" aria-hidden="true"></i>
      Current Model
    </h3>

    <div class="equation-display">
      y = <span id="current-slope">2.5</span>x + <span id="current-intercept">5</span>
    </div>

    <div class="metrics-display">
      <div class="metric-card">
        <div class="metric-value" id="mse-value">15.2</div>
        <div class="metric-label">Mean Squared Error</div>
      </div>
      <div class="metric-card">
        <div class="metric-value" id="r-squared">0.85</div>
        <div class="metric-label">RÂ² Score</div>
      </div>
      <div class="metric-card">
        <div class="metric-value" id="fit-quality">Good</div>
        <div class="metric-label">Fit Quality</div>
      </div>
    </div>
  </div>

  <!-- Visualization -->
  <div class="dp-content-block">
    <h3 class="dp-has-icon">
      <i class="fas fa-chart-scatter" aria-hidden="true"></i>
      Data & Regression Line
    </h3>

    <div class="plot-container">
      <div id="regression-plot" style="width: 100%; height: 400px;"></div>
    </div>
  </div>

  <!-- Understanding MSE -->
  <div class="dp-content-block">
    <h3 class="dp-has-icon">
      <i class="fas fa-lightbulb" aria-hidden="true"></i>
      Understanding Mean Squared Error
    </h3>

    <div class="dp-panels-wrapper">
      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="true" aria-controls="what-is-mse">
          What is MSE?
        </h4>
        <div id="what-is-mse" class="dp-panel-content">
          <p>Mean Squared Error (MSE) measures how far your predictions are from the actual values on average.</p>

          <ul class="list-group">
            <li class="list-group-item"><strong>Step 1:</strong> Calculate error for each point (predicted - actual)</li>
            <li class="list-group-item"><strong>Step 2:</strong> Square each error (to avoid negative cancellations)</li>
            <li class="list-group-item"><strong>Step 3:</strong> Take the average of squared errors</li>
          </ul>

          <div class="dp-card card" style="margin-top: 10px;">
            <div class="card-body">
              <h5 class="card-title">Formula</h5>
              <div style="text-align: center; font-family: 'Courier New', monospace; font-size: 1.1em;">
                MSE = (1/n) Ã— Î£(predicted - actual)Â²
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="interpreting-mse">
          Interpreting MSE Values
        </h4>
        <div id="interpreting-mse" class="dp-panel-content" hidden>
          <ul class="list-group">
            <li class="list-group-item">
              <strong>MSE < 10:</strong> Excellent fit - predictions are very close to actual values
              <span class="status-indicator status-excellent">Excellent</span>
            </li>
            <li class="list-group-item">
              <strong>MSE 10-30:</strong> Good fit - reasonable prediction accuracy
              <span class="status-indicator status-good">Good</span>
            </li>
            <li class="list-group-item">
              <strong>MSE 30-100:</strong> Fair fit - some prediction errors but usable
              <span class="status-indicator status-fair">Fair</span>
            </li>
            <li class="list-group-item">
              <strong>MSE > 100:</strong> Poor fit - significant prediction errors
              <span class="status-indicator status-poor">Poor</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="optimization-goal">
          The Optimization Goal
        </h4>
        <div id="optimization-goal" class="dp-panel-content" hidden>
          <p>Linear regression finds the slope and intercept that <strong>minimize</strong> the MSE. This gives us the "best fitting" line through the data.</p>

          <div class="dp-card card">
            <div class="card-body">
              <h5 class="card-title">Why Square the Errors?</h5>
              <ul class="list-group">
                <li class="list-group-item">Prevents positive and negative errors from canceling out</li>
                <li class="list-group-item">Penalizes larger errors more heavily (quadratic penalty)</li>
                <li class="list-group-item">Creates a smooth, differentiable function for optimization</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="business-implications">
          Business Implications
        </h4>
        <div id="business-implications" class="dp-panel-content" hidden>
          <ul class="list-group">
            <li class="list-group-item"><strong>Sales Forecasting:</strong> Lower MSE = more accurate revenue predictions</li>
            <li class="list-group-item"><strong>Inventory Management:</strong> Better demand predictions reduce overstock/stockout costs</li>
            <li class="list-group-item"><strong>Price Optimization:</strong> Accurate price-demand models improve profit margins</li>
            <li class="list-group-item"><strong>Risk Assessment:</strong> Lower prediction errors = better informed decisions</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Current Analysis -->
  <div class="dp-content-block">
    <h3 class="dp-has-icon">
      <i class="fas fa-analytics" aria-hidden="true"></i>
      Current Model Analysis
    </h3>

    <div class="dp-card card">
      <div class="card-body">
        <h5 class="card-title">Model Performance</h5>
        <p id="analysis-text">Adjust the slope and intercept to see how they affect the model's accuracy.</p>
        <div class="status-indicator status-good" id="performance-status">Good Fit</div>
      </div>
    </div>
  </div>
</div>

<!-- Canvas-safe toggling script -->
<script>
(function () {
  function toggleHead(h){
    const content = document.getElementById(h.getAttribute('aria-controls'));
    const expanded = h.getAttribute('aria-expanded') === 'true';
    h.setAttribute('aria-expanded', String(!expanded));
    if (content) content.hidden = expanded;
  }
  document.addEventListener('click', function (e) {
    const h = e.target.closest('.dp-panel-heading[role="button"]');
    if (h) toggleHead(h);
  });
  document.addEventListener('keydown', function (e) {
    if ((e.key === 'Enter' || e.key === ' ') && e.target.matches('.dp-panel-heading[role="button"]')) {
      e.preventDefault(); toggleHead(e.target);
    }
  });
})();

// Linear regression MSE explorer implementation
document.addEventListener('DOMContentLoaded', function() {
  // Sample data points
  let dataPoints = {
    x: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
    y: [3, 7, 8, 12, 15, 18, 21, 24, 26, 30]
  };

  const originalData = {
    x: [...dataPoints.x],
    y: [...dataPoints.y]
  };

  let currentSlope = 2.5;
  let currentIntercept = 5;

  // Calculate MSE
  function calculateMSE(slope, intercept) {
    let totalSquaredError = 0;

    for (let i = 0; i < dataPoints.x.length; i++) {
      const predicted = slope * dataPoints.x[i] + intercept;
      const actual = dataPoints.y[i];
      const error = predicted - actual;
      totalSquaredError += error * error;
    }

    return totalSquaredError / dataPoints.x.length;
  }

  // Calculate R-squared
  function calculateRSquared(slope, intercept) {
    const yMean = dataPoints.y.reduce((a, b) => a + b, 0) / dataPoints.y.length;
    let totalSumSquares = 0;
    let residualSumSquares = 0;

    for (let i = 0; i < dataPoints.x.length; i++) {
      const predicted = slope * dataPoints.x[i] + intercept;
      const actual = dataPoints.y[i];

      totalSumSquares += Math.pow(actual - yMean, 2);
      residualSumSquares += Math.pow(actual - predicted, 2);
    }

    return 1 - (residualSumSquares / totalSumSquares);
  }

  // Find optimal parameters using least squares
  function findOptimalParameters() {
    const n = dataPoints.x.length;
    const sumX = dataPoints.x.reduce((a, b) => a + b, 0);
    const sumY = dataPoints.y.reduce((a, b) => a + b, 0);
    const sumXY = dataPoints.x.reduce((sum, x, i) => sum + x * dataPoints.y[i], 0);
    const sumXX = dataPoints.x.reduce((sum, x) => sum + x * x, 0);

    const optimalSlope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
    const optimalIntercept = (sumY - optimalSlope * sumX) / n;

    return { slope: optimalSlope, intercept: optimalIntercept };
  }

  // Update the plot
  function updatePlot() {
    // Regression line data
    const xRange = [0, 11];
    const yPredicted = xRange.map(x => currentSlope * x + currentIntercept);

    // Data points
    const dataTrace = {
      x: dataPoints.x,
      y: dataPoints.y,
      mode: 'markers',
      type: 'scatter',
      name: 'Data Points',
      marker: {
        color: '#FF6B6B',
        size: 10,
        line: { color: '#FF4757', width: 2 }
      }
    };

    // Regression line
    const lineTrace = {
      x: xRange,
      y: yPredicted,
      mode: 'lines',
      type: 'scatter',
      name: 'Regression Line',
      line: { color: '#034638', width: 3 }
    };

    // Error lines
    const errorTraces = [];
    for (let i = 0; i < dataPoints.x.length; i++) {
      const predicted = currentSlope * dataPoints.x[i] + currentIntercept;
      errorTraces.push({
        x: [dataPoints.x[i], dataPoints.x[i]],
        y: [dataPoints.y[i], predicted],
        mode: 'lines',
        type: 'scatter',
        name: '',
        showlegend: false,
        line: { color: '#FFA726', width: 2, dash: 'dot' }
      });
    }

    const layout = {
      title: `Linear Regression (y = ${currentSlope}x + ${currentIntercept})`,
      xaxis: { title: 'X Values' },
      yaxis: { title: 'Y Values' },
      showlegend: true,
      height: 400
    };

    Plotly.newPlot('regression-plot', [dataTrace, lineTrace, ...errorTraces], layout);
  }

  // Update metrics display
  function updateMetrics() {
    const mse = calculateMSE(currentSlope, currentIntercept);
    const rSquared = calculateRSquared(currentSlope, currentIntercept);

    document.getElementById('mse-value').textContent = mse.toFixed(2);
    document.getElementById('r-squared').textContent = rSquared.toFixed(3);

    // Update fit quality
    let quality, statusClass, analysis;

    if (mse < 10) {
      quality = 'Excellent';
      statusClass = 'status-excellent';
      analysis = `Outstanding fit! With MSE = ${mse.toFixed(2)}, your model's predictions are very close to the actual values. This level of accuracy is excellent for practical applications.`;
    } else if (mse < 30) {
      quality = 'Good';
      statusClass = 'status-good';
      analysis = `Good fit! MSE = ${mse.toFixed(2)} indicates reasonable prediction accuracy. Your model captures the main trend in the data well.`;
    } else if (mse < 100) {
      quality = 'Fair';
      statusClass = 'status-fair';
      analysis = `Fair fit. MSE = ${mse.toFixed(2)} suggests moderate prediction errors. The model captures some patterns but could be improved.`;
    } else {
      quality = 'Poor';
      statusClass = 'status-poor';
      analysis = `Poor fit. MSE = ${mse.toFixed(2)} indicates significant prediction errors. Consider adjusting parameters or checking data quality.`;
    }

    document.getElementById('fit-quality').textContent = quality;
    document.getElementById('analysis-text').textContent = analysis;

    const statusElement = document.getElementById('performance-status');
    statusElement.textContent = `${quality} Fit`;
    statusElement.className = `status-indicator ${statusClass}`;
  }

  // Update display values
  function updateDisplayValues() {
    currentSlope = parseFloat(document.getElementById('slope-control').value);
    currentIntercept = parseFloat(document.getElementById('intercept-control').value);

    document.getElementById('slope-display').textContent = currentSlope.toFixed(1);
    document.getElementById('intercept-display').textContent = currentIntercept.toFixed(1);
    document.getElementById('current-slope').textContent = currentSlope.toFixed(1);
    document.getElementById('current-intercept').textContent = currentIntercept.toFixed(1);

    updatePlot();
    updateMetrics();
  }

  // Add noise to data
  function addNoise() {
    dataPoints.y = dataPoints.y.map(y => y + (Math.random() - 0.5) * 4);
    updatePlot();
    updateMetrics();
  }

  // Reset to original data
  function resetData() {
    dataPoints.x = [...originalData.x];
    dataPoints.y = [...originalData.y];
    updatePlot();
    updateMetrics();
  }

  // Find and apply optimal parameters
  function findOptimal() {
    const optimal = findOptimalParameters();

    currentSlope = optimal.slope;
    currentIntercept = optimal.intercept;

    document.getElementById('slope-control').value = currentSlope;
    document.getElementById('intercept-control').value = currentIntercept;

    updateDisplayValues();
  }

  // Event listeners
  document.getElementById('slope-control').addEventListener('input', updateDisplayValues);
  document.getElementById('intercept-control').addEventListener('input', updateDisplayValues);
  document.getElementById('find-optimal').addEventListener('click', findOptimal);
  document.getElementById('add-noise').addEventListener('click', addNoise);
  document.getElementById('reset-data').addEventListener('click', resetData);

  // Initialize
  updateDisplayValues();
});
</script>

</body>
</html>