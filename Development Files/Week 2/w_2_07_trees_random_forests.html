<div id="dp-wrapper" class="dp-wrapper">
  <div class="dp-progress-placeholder dp-module-progress-icons" style="display: none;">Icon Progress Bar (browser only)</div>

  <div class="dp-content-block content-block" data-title="Decision Trees & Random Forests">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-tree" aria-hidden="true"></i>&nbsp;Tree-Based Learning</h2>
    <div class="dp-card card" style="border-left: 4px solid #034638; padding-left: 15px;">
      <div class="card-body">
        <h3 class="card-title dp-ignore-theme">What this page covers</h3>
        <p>How decision trees split data to form <strong>human‑readable rules</strong>, how to control <strong>overfitting</strong>, and why ensembles like <strong>Random Forests</strong> usually deliver stronger accuracy and robustness.</p>
      </div>
    </div>
  </div>


  <div class="dp-content-block content-block" data-title="Trees: Concepts & Intuition">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-sitemap" aria-hidden="true"></i>&nbsp;Trees: Concepts & Intuition</h2>
    <div class="dp-panels-wrapper dp-accordion-default dp-panel-hover-color-dp-white dp-panel-active-color-dark">
      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="tree-splits">Choosing splits (purity)</h4>
        <div id="tree-splits" class="dp-panel-content" hidden>
          <p>At each node the algorithm tries different <strong>feature thresholds</strong> and picks the split that best increases <em>purity</em> of the child nodes (e.g., <strong>Gini</strong> or <strong>entropy</strong> for classification; <strong>MSE</strong> for regression).</p>
          <p class="mb-0">Leaves hold a final prediction: a class majority (classification) or mean value (regression).</p>
        </div>
      </div>
      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="tree-overfit">Overfitting & control</h4>
        <div id="tree-overfit" class="dp-panel-content" hidden>
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Limit depth</strong> (max_depth) and require <strong>min samples</strong> per split/leaf.</li>
            <li class="list-group-item">Use <strong>validation</strong> to pick limits; deep trees memorize noise.</li>
            <li class="list-group-item">Pruning or early stopping reduces variance.</li>
          </ul>
        </div>
      </div>
      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="tree-interpret">Interpretability</h4>
        <div id="tree-interpret" class="dp-panel-content" hidden>
          <p>Single trees are easy to explain (IF‑THEN rules), making them ideal for <strong>policy prototypes</strong> or regulated contexts—though they may lag state‑of‑the‑art accuracy.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="dp-content-block content-block" data-title="Random Forests: Ensembles">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-forest" aria-hidden="true"></i>&nbsp;Random Forests: Ensembles</h2>
    <div class="dp-panels-wrapper dp-accordion-default dp-panel-hover-color-dp-white">
      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="rf-bagging">Bagging & voting</h4>
        <div id="rf-bagging" class="dp-panel-content" hidden>
          <p>Train many trees on <strong>bootstrap samples</strong> (random draws with replacement). Combine their predictions by <strong>majority vote</strong> (classification) or <strong>average</strong> (regression). This reduces variance—overfitting drops.</p>
        </div>
      </div>
      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="rf-features">Feature subsampling</h4>
        <div id="rf-features" class="dp-panel-content" hidden>
          <p>Each split considers only a random subset of features (<em>max_features</em>). This forces trees to diversify, further improving robustness.</p>
        </div>
      </div>
      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="rf-oob">Out‑of‑bag (OOB) error</h4>
        <div id="rf-oob" class="dp-panel-content" hidden>
          <p>About one‑third of samples are left out of each bootstrap draw. Use them as a built‑in <strong>validation</strong> set to estimate error without a separate split.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="dp-content-block content-block" data-title="Interactive: Build a Tree">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-play-circle" aria-hidden="true"></i>&nbsp;Interactive: Build a Tree</h2>
    <p class="mt-2"><em>Try it:</em> Choose the first split and watch node purity change. Then compare a single tree to a random forest on the same data.</p>
    <div class="dp-embed-wrapper">
      <iframe title="Decision Tree & Random Forest Explorer" role="application" src="https://jkruckivey.github.io/AI-Prototyping-course/demos/widgets/w2-tree-forest-explorer.html" width="100%" height="700" loading="lazy" allowfullscreen aria-label="Interactive demo to choose tree splits, see node purity, and compare single tree vs random forest"></iframe>
    </div>
  </div>

  <div class="dp-content-block content-block" data-title="Feature Importance & Fairness">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-balance-scale" aria-hidden="true"></i>&nbsp;Feature Importance & Fairness</h2>
    <div class="dp-panels-wrapper dp-accordion-default dp-panel-hover-color-dp-white">
      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="fi-imp">Feature importance</h4>
        <div id="fi-imp" class="dp-panel-content" hidden>
          <p>Forests can score features by how much they reduce impurity across the ensemble. Use with care—correlated features can distort rankings; consider permutation importance for a second opinion.</p>
        </div>
      </div>
      <div class="dp-panel-group">
        <h4 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="fi-fair">Equity & access</h4>
        <div id="fi-fair" class="dp-panel-content" hidden>
          <p>Audit subgroup error rates (precision/recall/MAE) to prevent systematic disadvantages. Document exclusions and human‑in‑the‑loop checks for sensitive decisions.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="dp-callout dp-callout-placeholder card dp-callout-position-default w-100 dp-callout-type-default dp-callout-color-dp-primary">
    <div class="card-body">
      <h3 class="card-title">Helpful Tip</h3>
      <p class="card-text">Start with a shallow tree for explainability. If accuracy is insufficient, try a Random Forest with OOB error turned on, then tune <em>n_estimators</em>, <em>max_depth</em>, and <em>max_features</em>.</p>
    </div>
  </div>

  <hr />
  <p>Select <strong>Next▸</strong> to continue.</p>
</div>

<!-- Canvas‑safe toggling -->
<script>
(function () {
  function toggleHead(h){
    const content = document.getElementById(h.getAttribute('aria-controls'));
    const expanded = h.getAttribute('aria-expanded') === 'true';
    h.setAttribute('aria-expanded', String(!expanded));
    if (content) content.hidden = expanded;
  }
  document.addEventListener('click', function (e) {
    const h = e.target.closest('.dp-panel-heading[role=\"button\"]');
    if (h) toggleHead(h);
  });
  document.addEventListener('keydown', function (e) {
    if ((e.key === 'Enter' || e.key === ' ') && e.target.matches('.dp-panel-heading[role=\"button\"]')) {
      e.preventDefault(); toggleHead(e.target);
    }
  });
})();
</script>
