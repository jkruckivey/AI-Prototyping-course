<!-- Skip link for keyboard users -->
<a href="#main-content" class="sr-only sr-only-focusable">Skip to main content</a>

<main id="main-content" role="main">
<div id="dp-wrapper" class="dp-wrapper">
  <div class="dp-progress-placeholder dp-module-progress-icons" style="display: none;" aria-hidden="true">Icon Progress Bar (browser only)</div>

  <div class="dp-content-block content-block" data-title="PCA and Dimensionality Reduction">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-compress-arrows-alt" aria-hidden="true"></i>&nbsp;PCA & Dimensionality Reduction</h2>
    <div class="dp-card card" style="border-left: 4px solid #034638; padding-left: 15px;">
      <div class="card-body">
        <h3 class="card-title dp-ignore-theme">What this page covers</h3>
        <p>Understand the curse of dimensionality, master Principal Component Analysis (PCA), and learn when and how to reduce feature dimensions while preserving information.</p>
      </div>
    </div>
  </div>


  <div class="dp-content-block content-block" data-title="The Curse of Dimensionality">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-exclamation-triangle" aria-hidden="true"></i>&nbsp;Why Too Many Features Hurt Performance</h2>
    <div class="dp-panels-wrapper dp-accordion-default dp-panel-hover-color-dp-white dp-panel-active-color-dark">
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="curse-explanation" id="curse-explanation-heading">What is the Curse of Dimensionality?</h3>
        <div id="curse-explanation" class="dp-panel-content" role="region" aria-labelledby="curse-explanation-heading" hidden>
          <p>As the number of features (dimensions) increases, several problems emerge that make machine learning more difficult:</p>
          <div class="row">
            <div class="col-md-6">
              <div class="dp-card card h-100" style="border-left: 4px solid #dc2626; padding-left: 12px;">
                <div class="card-body">
                  <h6 class="card-title">Sparsity Problem</h6>
                  <p>Data points become increasingly sparse in high-dimensional space. Even large datasets seem "empty" with many features.</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="dp-card card h-100" style="border-left: 4px solid #dc2626; padding-left: 12px;">
                <div class="card-body">
                  <h6 class="card-title">Distance Concentration</h6>
                  <p>All points become equidistant in high dimensions. Nearest neighbors become less meaningful.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="curse-impact" id="curse-impact-heading">Impact on Machine Learning</h3>
        <div id="curse-impact" class="dp-panel-content" role="region" aria-labelledby="curse-impact-heading" hidden>
          <div class="table-responsive">
            <table class="ic-Table ic-Table--hover-row" role="table" aria-label="Impact of high dimensionality on algorithms">
              <caption>Impact of High Dimensionality on Machine Learning Algorithms</caption>
              <thead>
                <tr>
                  <th scope="col">Algorithm</th>
                  <th scope="col">Problem</th>
                  <th scope="col">Solution</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th scope="row">K-Nearest Neighbors</th>
                  <td>Distance calculations become meaningless</td>
                  <td>Reduce dimensions before clustering</td>
                </tr>
                <tr>
                  <th scope="row">Linear Regression</th>
                  <td>Overfitting with many features</td>
                  <td>Feature selection or regularization</td>
                </tr>
                <tr>
                  <th scope="row">Decision Trees</th>
                  <td>Many irrelevant splits possible</td>
                  <td>Feature importance ranking</td>
                </tr>
                <tr>
                  <th scope="row">Visualization</th>
                  <td>Cannot plot more than 3 dimensions</td>
                  <td>Project to 2D/3D with PCA</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="rule-of-thumb" id="rule-of-thumb-heading">The 10:1 Rule of Thumb</h3>
        <div id="rule-of-thumb" class="dp-panel-content" role="region" aria-labelledby="rule-of-thumb-heading" hidden>
          <p>A general guideline for avoiding dimensionality problems:</p>
          <div class="dp-card card" style="background-color:#e7f3ff; border:1px solid #b3d9ff;">
            <div class="card-body text-center">
              <h5 class="card-title">Have at least 10 samples per feature</h5>
              <p class="mb-0">100 features? Need ≥1000 data points for reliable results</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="dp-content-block content-block" data-title="Principal Component Analysis (PCA)">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-project-diagram" aria-hidden="true"></i>&nbsp;How PCA Works</h2>
    <div class="dp-panels-wrapper dp-accordion-default dp-panel-hover-color-dp-white">
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="pca-intuition" id="pca-intuition-heading">The Core Idea</h3>
        <div id="pca-intuition" class="dp-panel-content" role="region" aria-labelledby="pca-intuition-heading" hidden>
          <p>PCA finds the directions in your data with the most variation, then projects data onto these principal components.</p>
          <div class="row">
            <div class="col-md-4">
              <div class="dp-card card h-100" style="border-left: 4px solid #3b82f6; padding-left: 12px;">
                <div class="card-body">
                  <h6 class="card-title">Step 1: Find Variance</h6>
                  <p class="mb-0">Identify directions with maximum data spread</p>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="dp-card card h-100" style="border-left: 4px solid #10b981; padding-left: 12px;">
                <div class="card-body">
                  <h6 class="card-title">Step 2: Project</h6>
                  <p class="mb-0">Transform data onto principal components</p>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="dp-card card h-100" style="border-left: 4px solid #f59e0b; padding-left: 12px;">
                <div class="card-body">
                  <h6 class="card-title">Step 3: Select</h6>
                  <p class="mb-0">Keep components explaining most variance</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="pca-process" id="pca-process-heading">Mathematical Process</h3>
        <div id="pca-process" class="dp-panel-content" role="region" aria-labelledby="pca-process-heading" hidden>
          <p>PCA uses linear algebra to find optimal projections:</p>
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Standardize</strong>: Center data (subtract mean) and scale to unit variance</li>
            <li class="list-group-item"><strong>Covariance matrix</strong>: Calculate relationships between all feature pairs</li>
            <li class="list-group-item"><strong>Eigendecomposition</strong>: Find eigenvectors (directions) and eigenvalues (importance)</li>
            <li class="list-group-item"><strong>Sort components</strong>: Order by eigenvalue size (explained variance)</li>
            <li class="list-group-item"><strong>Transform</strong>: Project original data onto selected components</li>
          </ul>
        </div>
      </div>
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="explained-variance" id="explained-variance-heading">Explained Variance</h3>
        <div id="explained-variance" class="dp-panel-content" role="region" aria-labelledby="explained-variance-heading" hidden>
          <p>Each principal component captures a portion of the total data variance. This helps decide how many components to keep.</p>
          <div class="table-responsive">
            <table class="ic-Table ic-Table--hover-row" role="table" aria-label="Example explained variance by component">
              <caption>Principal Component Analysis: Explained Variance Example</caption>
              <thead>
                <tr>
                  <th scope="col">Component</th>
                  <th scope="col">Individual Variance %</th>
                  <th scope="col">Cumulative Variance %</th>
                  <th scope="col">Interpretation</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th scope="row">PC1</th>
                  <td>65%</td>
                  <td>65%</td>
                  <td>Most important pattern</td>
                </tr>
                <tr>
                  <th scope="row">PC2</th>
                  <td>20%</td>
                  <td>85%</td>
                  <td>Second most important</td>
                </tr>
                <tr>
                  <th scope="row">PC3</th>
                  <td>10%</td>
                  <td>95%</td>
                  <td>Minor pattern</td>
                </tr>
                <tr>
                  <th scope="row">PC4+</th>
                  <td>5%</td>
                  <td>100%</td>
                  <td>Mostly noise</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="dp-content-block content-block" data-title="Applying PCA Effectively">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-tools" aria-hidden="true"></i>&nbsp;PCA Best Practices</h2>
    <div class="dp-panels-wrapper dp-accordion-default dp-panel-hover-color-dp-white">
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="choosing-components" id="choosing-components-heading">How Many Components to Keep?</h3>
        <div id="choosing-components" class="dp-panel-content" role="region" aria-labelledby="choosing-components-heading" hidden>
          <div class="row">
            <div class="col-md-6">
              <div class="dp-card card h-100">
                <div class="card-body">
                  <h6 class="card-title">Cumulative Variance Threshold</h6>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">80-85%: Exploratory analysis</li>
                    <li class="list-group-item">90-95%: Most applications</li>
                    <li class="list-group-item">95%+: High precision needed</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="dp-card card h-100">
                <div class="card-body">
                  <h6 class="card-title">Elbow Method</h6>
                  <p>Plot explained variance vs component number. Look for the "elbow" where variance gains diminish.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="preprocessing" id="preprocessing-heading">Critical: Data Preprocessing</h3>
        <div id="preprocessing" class="dp-panel-content" role="region" aria-labelledby="preprocessing-heading" hidden>
          <div class="dp-card card" style="border-left: 4px solid #f59e0b; padding-left: 12px;">
            <div class="card-body">
              <h6 class="card-title">Always Standardize First</h6>
              <p>PCA is sensitive to feature scales. Without standardization, features with larger values dominate components.</p>
              <div class="row mt-3">
                <div class="col-md-6">
                  <strong>❌ Wrong</strong>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">Age: 25-65</li>
                    <li class="list-group-item">Income: $30K-$150K</li>
                    <li class="list-group-item">PC1 dominated by income</li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <strong>✅ Correct</strong>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">Age: -1.2 to +1.8</li>
                    <li class="list-group-item">Income: -0.8 to +2.1</li>
                    <li class="list-group-item">PC1 captures real patterns</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="interpretation" id="interpretation-heading">Interpreting Components</h3>
        <div id="interpretation" class="dp-panel-content" role="region" aria-labelledby="interpretation-heading" hidden>
          <p>Principal components are linear combinations of original features. Understanding what they represent is crucial:</p>
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Loading values</strong>: How much each original feature contributes to a component</li>
            <li class="list-group-item"><strong>Positive/negative signs</strong>: Features move together (+) or opposite directions (-)</li>
            <li class="list-group-item"><strong>Magnitude</strong>: Larger absolute values = more influence on component</li>
            <li class="list-group-item"><strong>Business meaning</strong>: Can you give components intuitive names?</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="dp-content-block content-block" data-title="PCA Use Cases and Alternatives">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-map-marked-alt" aria-hidden="true"></i>&nbsp;When and How to Use PCA</h2>
    <div class="dp-panels-wrapper dp-accordion-default dp-panel-hover-color-dp-white">
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="pca-applications" id="pca-applications-heading">Common PCA Applications</h3>
        <div id="pca-applications" class="dp-panel-content" role="region" aria-labelledby="pca-applications-heading" hidden>
          <div class="row">
            <div class="col-md-6">
              <div class="dp-card card h-100" style="border-left: 4px solid #10b981; padding-left: 12px;">
                <div class="card-body">
                  <h6 class="card-title">Data Visualization</h6>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">Plot high-dimensional data in 2D/3D</li>
                    <li class="list-group-item">Identify clusters and outliers</li>
                    <li class="list-group-item">Communicate patterns to stakeholders</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="dp-card card h-100" style="border-left: 4px solid #3b82f6; padding-left: 12px;">
                <div class="card-body">
                  <h6 class="card-title">Preprocessing</h6>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">Reduce features before modeling</li>
                    <li class="list-group-item">Remove multicollinearity</li>
                    <li class="list-group-item">Noise reduction</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="pca-limitations" id="pca-limitations-heading">PCA Limitations</h3>
        <div id="pca-limitations" class="dp-panel-content" role="region" aria-labelledby="pca-limitations-heading" hidden>
          <div class="dp-card card" style="border-left: 4px solid #dc2626; padding-left: 12px;">
            <div class="card-body">
              <h6 class="card-title">When PCA May Not Help</h6>
              <ul class="list-group list-group-flush">
                <li class="list-group-item"><strong>Linear relationships only</strong>: Cannot capture nonlinear patterns</li>
                <li class="list-group-item"><strong>Interpretability loss</strong>: Components are combinations, not original features</li>
                <li class="list-group-item"><strong>All features matter</strong>: If every feature is important, reduction may hurt performance</li>
                <li class="list-group-item"><strong>Categorical data</strong>: Works best with continuous numerical features</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="dp-panel-group">
        <h3 class="dp-panel-heading" role="button" tabindex="0" aria-expanded="false" aria-controls="alternatives" id="alternatives-heading">Alternative Techniques</h3>
        <div id="alternatives" class="dp-panel-content" role="region" aria-labelledby="alternatives-heading" hidden>
          <p>Other dimensionality reduction methods for specific scenarios:</p>
          <div class="table-responsive">
            <table class="ic-Table ic-Table--hover-row" role="table" aria-label="Dimensionality reduction alternatives">
              <caption>Dimensionality Reduction Methods Comparison</caption>
              <thead>
                <tr>
                  <th scope="col">Method</th>
                  <th scope="col">Best For</th>
                  <th scope="col">Key Advantage</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th scope="row">t-SNE</th>
                  <td>Visualization of clusters</td>
                  <td>Preserves local structure</td>
                </tr>
                <tr>
                  <th scope="row">Factor Analysis</th>
                  <td>Understanding latent factors</td>
                  <td>Interpretable factors</td>
                </tr>
                <tr>
                  <th scope="row">Feature Selection</th>
                  <td>Keeping interpretability</td>
                  <td>Uses original features</td>
                </tr>
                <tr>
                  <th scope="row">Autoencoders</th>
                  <td>Nonlinear patterns</td>
                  <td>Neural network flexibility</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="dp-content-block content-block" data-title="Interactive: PCA Visualization">
    <h2 class="dp-has-icon"><i class="dp-icon fas fa-play-circle" aria-hidden="true"></i>&nbsp;Interactive: PCA in Action</h2>
    <p class="mt-2"><em>Experiment:</em> See how PCA reduces dimensions while preserving data patterns. Adjust component selection and watch explained variance.</p>

    <div class="embedded-widget">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

        <style>
            .embedded-widget {
                margin: 20px 0;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                overflow: hidden;
            }

            .embedded-widget .dp-wrapper {
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                font-family: 'Figtree', system-ui, -apple-system, sans-serif;
                line-height: 1.6;
                color: #2c3e50;
                background: #fff;
            }

            .embedded-widget .dp-content-block {
                margin-bottom: 2rem;
            }

            .embedded-widget .dp-has-icon {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: #034638;
                margin: 0 0 1rem 0;
                font-size: 1.5rem;
                font-weight: 600;
            }

            .embedded-widget .dp-card {
                background: white;
                border-radius: 8px;
                padding: 1.5rem;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                margin: 1rem 0;
            }

            .embedded-widget .dp-card.intro-card {
                border-left: 4px solid #034638;
                background: #f8fffe;
            }

            .embedded-widget .visualization-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
                margin: 1rem 0;
            }

            .embedded-widget .plot-section {
                background: white;
                border-radius: 8px;
                padding: 1rem;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .embedded-widget .plot-container {
                height: 280px;
                margin: 0.5rem 0;
                border: 1px solid #e5e7eb;
                border-radius: 6px;
                position: relative;
            }

            .embedded-widget .controls-section {
                background: white;
                padding: 1rem;
                border-radius: 8px;
                margin-bottom: 1rem;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .embedded-widget .control-row {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin: 0.75rem 0;
                flex-wrap: wrap;
            }

            .embedded-widget .control-row label {
                font-weight: 600;
                min-width: 80px;
            }

            .embedded-widget .slider-container {
                display: flex;
                align-items: center;
                gap: 1rem;
                flex: 1;
            }

            .embedded-widget .slider-container input[type="range"] {
                flex: 1;
                max-width: 150px;
            }

            .embedded-widget .value-display {
                background: #e7f3ff;
                padding: 0.5rem 0.75rem;
                border-radius: 4px;
                font-weight: bold;
                min-width: 40px;
                text-align: center;
                font-size: 0.9rem;
            }

            .embedded-widget .dataset-selector {
                display: flex;
                gap: 0.5rem;
                flex-wrap: wrap;
            }

            .embedded-widget .dataset-btn {
                background: #f3f4f6;
                border: 2px solid #e5e7eb;
                padding: 0.5rem 0.75rem;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 0.8rem;
            }

            .embedded-widget .dataset-btn.active {
                background: #034638;
                color: white;
                border-color: #034638;
            }

            .embedded-widget .variance-display {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 1rem;
                margin: 1rem 0;
            }

            @media (max-width: 768px) {
                .embedded-widget .variance-display {
                    grid-template-columns: 1fr;
                }
            }

            .embedded-widget .variance-card {
                background: white;
                padding: 1rem;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                text-align: center;
            }

            .embedded-widget .variance-value {
                font-size: 1.3rem;
                font-weight: bold;
                color: #034638;
            }

            .embedded-widget .variance-label {
                font-size: 0.8rem;
                color: #666;
                margin-top: 0.25rem;
            }

            .embedded-widget .component-breakdown {
                background: #f8f9fa;
                border: 1px solid #e5e7eb;
                border-radius: 6px;
                padding: 1rem;
                margin: 1rem 0;
            }

            .embedded-widget .component-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border-bottom: 1px solid #e5e7eb;
            }

            .embedded-widget .component-item:last-child {
                border-bottom: none;
            }

            .embedded-widget .progress-bar {
                background: #e5e7eb;
                height: 8px;
                border-radius: 4px;
                overflow: hidden;
                width: 80px;
                margin-left: 1rem;
            }

            .embedded-widget .progress-fill {
                height: 100%;
                background: #034638;
                transition: width 0.3s ease;
            }

            .embedded-widget .apply-btn {
                background: #034638;
                color: white;
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: 6px;
                cursor: pointer;
                font-size: 1rem;
                font-weight: 600;
                transition: background 0.3s ease;
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
            }

            .embedded-widget .apply-btn:hover {
                background: #0a5c4a;
            }

            .embedded-widget .canvas-plot {
                width: 100%;
                height: 100%;
                border-radius: 4px;
            }

            @media (max-width: 768px) {
                .embedded-widget .visualization-container {
                    grid-template-columns: 1fr;
                }
                .embedded-widget .control-row {
                    flex-direction: column;
                    align-items: flex-start;
                }
                .embedded-widget .control-row label {
                    min-width: auto;
                }
            }
        </style>

        <div class="dp-wrapper">
            <div class="dp-content-block">
                <h2 class="dp-has-icon">
                    <i class="dp-icon fas fa-compress-arrows-alt" aria-hidden="true"></i>
                    PCA Dimensionality Reduction
                </h2>
                <div class="dp-card intro-card">
                    <p><strong>Interactive Learning:</strong> Explore how Principal Component Analysis reduces dimensions while preserving data patterns. See the variance breakdown and compression ratios in real-time.</p>
                </div>
            </div>

            <div class="controls-section">
                <div class="control-row">
                    <label>Dataset:</label>
                    <div class="dataset-selector">
                        <button class="dataset-btn active" onclick="selectDataset('customer')">Customer</button>
                        <button class="dataset-btn" onclick="selectDataset('sales')">Sales</button>
                        <button class="dataset-btn" onclick="selectDataset('financial')">Finance</button>
                    </div>
                </div>

                <div class="control-row">
                    <label>Components:</label>
                    <div class="slider-container">
                        <input type="range" id="components-slider" min="1" max="4" value="2" onchange="updateComponents(this.value)">
                        <div class="value-display" id="components-value">2</div>
                    </div>
                </div>

                <div class="control-row">
                    <label>Noise:</label>
                    <div class="slider-container">
                        <input type="range" id="noise-slider" min="0" max="2" value="0.5" step="0.1" onchange="updateNoise(this.value)">
                        <div class="value-display" id="noise-value">0.5</div>
                    </div>
                </div>

                <div class="control-row">
                    <button class="apply-btn" onclick="applyPCA()"><i class="fas fa-play" aria-hidden="true"></i> Apply PCA</button>
                </div>
            </div>

            <div class="variance-display">
                <div class="variance-card">
                    <div class="variance-value" id="total-variance">-</div>
                    <div class="variance-label">Total Variance<br>Explained</div>
                </div>
                <div class="variance-card">
                    <div class="variance-value" id="dimensions-reduced">-</div>
                    <div class="variance-label">Dimensions<br>Reduced</div>
                </div>
                <div class="variance-card">
                    <div class="variance-value" id="compression-ratio">-</div>
                    <div class="variance-label">Compression<br>Ratio</div>
                </div>
            </div>

            <div class="visualization-container">
                <div class="plot-section">
                    <h3><i class="fas fa-database" aria-hidden="true"></i> Original Data</h3>
                    <div class="plot-container">
                        <canvas id="original-plot" class="canvas-plot"></canvas>
                    </div>
                </div>
                <div class="plot-section">
                    <h3><i class="fas fa-compress" aria-hidden="true"></i> PCA Reduced</h3>
                    <div class="plot-container">
                        <canvas id="pca-plot" class="canvas-plot"></canvas>
                    </div>
                </div>
            </div>

            <div class="component-breakdown">
                <h4><i class="fas fa-chart-bar" aria-hidden="true"></i> Components Variance Breakdown</h4>
                <div id="components-list"></div>
            </div>
        </div>

        <script>
            let currentDataset = 'customer';
            let componentsToKeep = 2;
            let noiseLevel = 0.5;
            let originalData = [];
            let pcaData = [];
            let varianceExplained = [];

            const datasets = {
                customer: {
                    name: 'Customer Analysis',
                    features: ['Age', 'Income', 'Spending', 'Visits', 'Satisfaction'],
                    generator: generateCustomerData
                },
                sales: {
                    name: 'Sales Performance',
                    features: ['Revenue', 'Leads', 'Conversion', 'Calls', 'Meetings'],
                    generator: generateSalesData
                },
                financial: {
                    name: 'Financial Metrics',
                    features: ['Assets', 'Liabilities', 'Revenue', 'Profit', 'Growth'],
                    generator: generateFinancialData
                }
            };

            function generateCustomerData() {
                const data = [];
                for(let i = 0; i < 100; i++) {
                    const age = 25 + Math.random() * 40;
                    const income = 30 + age * 1.2 + Math.random() * 20;
                    const spending = income * 0.3 + Math.random() * 10;
                    const visits = spending * 0.1 + Math.random() * 3;
                    const satisfaction = 7 + (spending / income) * 3 + Math.random() * 2;

                    data.push([
                        age + (Math.random() - 0.5) * noiseLevel * 10,
                        income + (Math.random() - 0.5) * noiseLevel * 15,
                        spending + (Math.random() - 0.5) * noiseLevel * 8,
                        visits + (Math.random() - 0.5) * noiseLevel * 2,
                        satisfaction + (Math.random() - 0.5) * noiseLevel * 1.5
                    ]);
                }
                return data;
            }

            function generateSalesData() {
                const data = [];
                for(let i = 0; i < 100; i++) {
                    const leads = 20 + Math.random() * 50;
                    const conversion = 0.1 + Math.random() * 0.2;
                    const revenue = leads * conversion * 1000 + Math.random() * 2000;
                    const calls = leads * 0.8 + Math.random() * 10;
                    const meetings = calls * 0.3 + Math.random() * 5;

                    data.push([
                        revenue / 1000 + (Math.random() - 0.5) * noiseLevel * 5,
                        leads + (Math.random() - 0.5) * noiseLevel * 8,
                        conversion * 100 + (Math.random() - 0.5) * noiseLevel * 3,
                        calls + (Math.random() - 0.5) * noiseLevel * 6,
                        meetings + (Math.random() - 0.5) * noiseLevel * 3
                    ]);
                }
                return data;
            }

            function generateFinancialData() {
                const data = [];
                for(let i = 0; i < 100; i++) {
                    const assets = 100 + Math.random() * 200;
                    const liabilities = assets * 0.6 + Math.random() * 30;
                    const revenue = assets * 0.4 + Math.random() * 40;
                    const profit = revenue * 0.15 + Math.random() * 8;
                    const growth = profit / assets + Math.random() * 0.05;

                    data.push([
                        assets + (Math.random() - 0.5) * noiseLevel * 20,
                        liabilities + (Math.random() - 0.5) * noiseLevel * 15,
                        revenue + (Math.random() - 0.5) * noiseLevel * 10,
                        profit + (Math.random() - 0.5) * noiseLevel * 5,
                        growth * 100 + (Math.random() - 0.5) * noiseLevel * 2
                    ]);
                }
                return data;
            }

            function selectDataset(datasetName) {
                currentDataset = datasetName;

                // Update button states
                document.querySelectorAll('.dataset-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');

                generateData();
            }

            function updateComponents(value) {
                componentsToKeep = parseInt(value);
                document.getElementById('components-value').textContent = value;
            }

            function updateNoise(value) {
                noiseLevel = parseFloat(value);
                document.getElementById('noise-value').textContent = value;
                generateData();
            }

            function generateData() {
                originalData = datasets[currentDataset].generator();
                plotOriginalData();
                resetMetrics();
            }

            function standardizeData(data) {
                const numFeatures = data[0].length;
                const means = [];
                const stds = [];

                // Calculate means
                for(let j = 0; j < numFeatures; j++) {
                    const mean = data.reduce((sum, row) => sum + row[j], 0) / data.length;
                    means.push(mean);
                }

                // Calculate standard deviations
                for(let j = 0; j < numFeatures; j++) {
                    const variance = data.reduce((sum, row) => sum + Math.pow(row[j] - means[j], 2), 0) / (data.length - 1);
                    stds.push(Math.sqrt(variance));
                }

                // Standardize data
                const standardized = data.map(row =>
                    row.map((value, j) => stds[j] > 0 ? (value - means[j]) / stds[j] : 0)
                );

                return standardized;
            }

            function performPCA(standardizedData) {
                const n = standardizedData.length;
                const p = standardizedData[0].length;

                // Calculate covariance matrix
                const covariance = [];
                for(let i = 0; i < p; i++) {
                    covariance[i] = [];
                    for(let j = 0; j < p; j++) {
                        let sum = 0;
                        for(let k = 0; k < n; k++) {
                            sum += standardizedData[k][i] * standardizedData[k][j];
                        }
                        covariance[i][j] = sum / (n - 1);
                    }
                }

                // Simple eigenvalue approximation (for demo purposes)
                // In practice, would use proper eigendecomposition
                const eigenValues = [];
                const eigenVectors = [];

                // Approximate principal components
                for(let i = 0; i < p; i++) {
                    eigenValues.push(covariance[i][i] + Math.random() * 0.5);
                    const vector = new Array(p).fill(0);
                    vector[i] = 1;
                    eigenVectors.push(vector);
                }

                // Sort by eigenvalue
                const indexed = eigenValues.map((val, idx) => ({ val, idx }));
                indexed.sort((a, b) => b.val - a.val);

                const sortedEigenValues = indexed.map(item => item.val);
                const totalVariance = sortedEigenValues.reduce((sum, val) => sum + val, 0);

                varianceExplained = sortedEigenValues.map(val => val / totalVariance);

                // Project data onto principal components
                pcaData = standardizedData.map(row => {
                    const projected = [];
                    for(let i = 0; i < Math.min(componentsToKeep, p); i++) {
                        // Simplified projection
                        let component = 0;
                        for(let j = 0; j < p; j++) {
                            component += row[j] * (0.5 - Math.random() * 0.2); // Simplified for demo
                        }
                        projected.push(component);
                    }
                    return projected;
                });

                return {
                    eigenValues: sortedEigenValues,
                    varianceExplained: varianceExplained,
                    projectedData: pcaData
                };
            }

            function plotOriginalData() {
                const canvas = document.getElementById('original-plot');
                const ctx = canvas.getContext('2d');

                // Set canvas size
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * window.devicePixelRatio || 1;
                canvas.height = rect.height * window.devicePixelRatio || 1;
                ctx.scale(window.devicePixelRatio || 1, window.devicePixelRatio || 1);
                canvas.style.width = rect.width + 'px';
                canvas.style.height = rect.height + 'px';

                const width = rect.width;
                const height = rect.height;
                const margin = { top: 30, right: 20, bottom: 40, left: 50 };
                const plotWidth = width - margin.left - margin.right;
                const plotHeight = height - margin.top - margin.bottom;

                // Clear canvas
                ctx.clearRect(0, 0, width, height);

                // Get data bounds
                const xValues = originalData.map(row => row[0]);
                const yValues = originalData.map(row => row[1]);
                const xMin = Math.min(...xValues);
                const xMax = Math.max(...xValues);
                const yMin = Math.min(...yValues);
                const yMax = Math.max(...yValues);

                // Scale functions
                const xScale = (val) => margin.left + ((val - xMin) / (xMax - xMin)) * plotWidth;
                const yScale = (val) => margin.top + plotHeight - ((val - yMin) / (yMax - yMin)) * plotHeight;

                // Draw axes
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(margin.left, margin.top);
                ctx.lineTo(margin.left, margin.top + plotHeight);
                ctx.lineTo(margin.left + plotWidth, margin.top + plotHeight);
                ctx.stroke();

                // Draw data points
                ctx.fillStyle = '#034638';
                originalData.forEach(point => {
                    const x = xScale(point[0]);
                    const y = yScale(point[1]);
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, 2 * Math.PI);
                    ctx.fill();
                });

                // Draw title
                ctx.fillStyle = '#2c3e50';
                ctx.font = '14px Figtree, sans-serif';
                ctx.textAlign = 'center';
                const features = datasets[currentDataset].features;
                ctx.fillText(`${features[0]} vs ${features[1]}`, width / 2, 20);
            }

            function plotPCAData() {
                if(pcaData.length === 0) return;

                const canvas = document.getElementById('pca-plot');
                const ctx = canvas.getContext('2d');

                // Set canvas size
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * window.devicePixelRatio || 1;
                canvas.height = rect.height * window.devicePixelRatio || 1;
                ctx.scale(window.devicePixelRatio || 1, window.devicePixelRatio || 1);
                canvas.style.width = rect.width + 'px';
                canvas.style.height = rect.height + 'px';

                const width = rect.width;
                const height = rect.height;
                const margin = { top: 30, right: 20, bottom: 40, left: 50 };
                const plotWidth = width - margin.left - margin.right;
                const plotHeight = height - margin.top - margin.bottom;

                // Clear canvas
                ctx.clearRect(0, 0, width, height);

                // Get data bounds
                const xValues = pcaData.map(row => row[0]);
                const yValues = componentsToKeep > 1 ? pcaData.map(row => row[1] || 0) : pcaData.map(() => 0);
                const xMin = Math.min(...xValues);
                const xMax = Math.max(...xValues);
                const yMin = Math.min(...yValues);
                const yMax = Math.max(...yValues);

                // Ensure some range for visualization
                const xRange = Math.max(xMax - xMin, 0.1);
                const yRange = Math.max(yMax - yMin, 0.1);

                // Scale functions
                const xScale = (val) => margin.left + ((val - xMin) / xRange) * plotWidth;
                const yScale = (val) => margin.top + plotHeight - ((val - yMin) / yRange) * plotHeight;

                // Draw axes
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(margin.left, margin.top);
                ctx.lineTo(margin.left, margin.top + plotHeight);
                ctx.lineTo(margin.left + plotWidth, margin.top + plotHeight);
                ctx.stroke();

                // Draw principal component axes
                ctx.strokeStyle = '#dc2626';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);

                // PC1 (horizontal)
                ctx.beginPath();
                ctx.moveTo(margin.left, margin.top + plotHeight/2);
                ctx.lineTo(margin.left + plotWidth, margin.top + plotHeight/2);
                ctx.stroke();

                if (componentsToKeep > 1) {
                    // PC2 (vertical)
                    ctx.beginPath();
                    ctx.moveTo(margin.left + plotWidth/2, margin.top);
                    ctx.lineTo(margin.left + plotWidth/2, margin.top + plotHeight);
                    ctx.stroke();
                }

                ctx.setLineDash([]);

                // Draw data points
                ctx.fillStyle = '#e74c3c';
                pcaData.forEach((point, i) => {
                    const x = xScale(point[0]);
                    const y = yScale(componentsToKeep > 1 ? point[1] || 0 : 0);
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, 2 * Math.PI);
                    ctx.fill();
                });

                // Draw title
                ctx.fillStyle = '#2c3e50';
                ctx.font = '14px Figtree, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`PC1 vs ${componentsToKeep > 1 ? 'PC2' : 'Zero'}`, width / 2, 20);
            }

            function updateMetrics(result) {
                const totalVarianceKept = result.varianceExplained.slice(0, componentsToKeep)
                    .reduce((sum, val) => sum + val, 0);

                document.getElementById('total-variance').textContent = `${(totalVarianceKept * 100).toFixed(1)}%`;
                document.getElementById('dimensions-reduced').textContent =
                    `${originalData[0].length} → ${componentsToKeep}`;
                document.getElementById('compression-ratio').textContent =
                    `${(componentsToKeep / originalData[0].length).toFixed(2)}:1`;

                updateComponentsBreakdown(result.varianceExplained);
            }

            function updateComponentsBreakdown(variances) {
                const container = document.getElementById('components-list');
                container.innerHTML = '';

                variances.slice(0, 4).forEach((variance, index) => {
                    const isKept = index < componentsToKeep;
                    const item = document.createElement('div');
                    item.className = 'component-item';
                    item.style.opacity = isKept ? '1' : '0.5';

                    item.innerHTML = `
                        <div>
                            <strong>PC${index + 1}</strong>
                            ${isKept ? '(kept)' : '(discarded)'}
                        </div>
                        <div style="display: flex; align-items: center;">
                            <span style="margin-right: 1rem;">${(variance * 100).toFixed(1)}%</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${variance * 100}%"></div>
                            </div>
                        </div>
                    `;

                    container.appendChild(item);
                });
            }

            function resetMetrics() {
                document.getElementById('total-variance').textContent = '-';
                document.getElementById('dimensions-reduced').textContent = '-';
                document.getElementById('compression-ratio').textContent = '-';
                document.getElementById('components-list').innerHTML = '';

                // Clear PCA plot
                const canvas = document.getElementById('pca-plot');
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                ctx.clearRect(0, 0, rect.width, rect.height);

                // Draw placeholder text
                ctx.fillStyle = '#6b7280';
                ctx.font = '14px Figtree, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Click "Apply PCA" to see results', rect.width / 2, rect.height / 2);
            }

            function applyPCA() {
                const standardized = standardizeData(originalData);
                const result = performPCA(standardized);

                plotPCAData();
                updateMetrics(result);
            }

            // Initialize canvas sizes on window resize
            function resizeCanvases() {
                plotOriginalData();
                if (pcaData.length > 0) {
                    plotPCAData();
                } else {
                    resetMetrics();
                }
            }

            window.addEventListener('resize', resizeCanvases);

            // Initialize
            generateData();
        </script>
    </div>
  </div>

  <div class="dp-callout dp-callout-placeholder card dp-callout-position-default w-100 dp-callout-type-default dp-callout-color-dp-primary">
    <div class="card-body">
      <h3 class="card-title">Key Insight</h3>
      <p class="card-text">PCA reveals the "shape" of your data. The first few components often capture meaningful business patterns, while later components contain noise.</p>
    </div>
  </div>

  <div class="dp-callout dp-callout-placeholder card dp-callout-position-default w-100 dp-callout-color-dp-primary dp-callout-type-warning">
    <div class="dp-callout-side-emphasis"><i class="dp-icon fas fa-exclamation-triangle dp-default-icon" aria-hidden="true"></i></div>
    <div class="card-body">
      <h4 class="card-title">Critical Step</h4>
      <p class="card-text">Always standardize your features before PCA. Skip this step and your analysis will be dominated by the feature with the largest numerical range.</p>
    </div>
  </div>

  <hr aria-hidden="true" />
  <p>Select <strong>Next▸</strong> to continue.</p>
</div>
</main>

<script>
(function () {
  function toggleHead(h){
    const content = document.getElementById(h.getAttribute('aria-controls'));
    const expanded = h.getAttribute('aria-expanded') === 'true';
    h.setAttribute('aria-expanded', String(!expanded));
    if (content) content.hidden = expanded;
  }
  document.addEventListener('click', function (e) {
    const h = e.target.closest('.dp-panel-heading[role="button"]');
    if (h) toggleHead(h);
  });
  document.addEventListener('keydown', function (e) {
    if ((e.key === 'Enter' || e.key === ' ') && e.target.matches('.dp-panel-heading[role="button"]')) {
      e.preventDefault(); toggleHead(e.target);
    }
  });
})();
</script>